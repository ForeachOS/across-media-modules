<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
		xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
    <property name="now" value="GETDATE()" dbms="mssql"/>
    <property name="now" value="NOW" dbms="hsqldb"/>
	<changeSet id="201306300938" author="arne">
		<comment>Creates application table</comment>
		<createTable tableName="application">
			<column name="id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(100)">
				<constraints nullable="false"/>
			</column>
			<column name="code" type="varchar(36)">
				<constraints nullable="false"/>
			</column>
			<column name="active" type="boolean" defaultValueBoolean="false"/>
			<column name="created" type="datetime" defaultValueComputed="${now}">
				<constraints nullable="false"/>
			</column>
			<column name="updated" type="datetime"/>
		</createTable>
	</changeSet>

	<changeSet id="201307071258" author="arne">
		<comment>Creates Image and imagetype table</comment>
		<createTable tableName="imagetype">
			<column name="id" type="varchar(10)">
				<constraints primaryKey="true"/>
			</column>
			<column name="contenttype" type="varchar(50)">
				<constraints nullable="false" unique="true"/>
			</column>
		</createTable>
		<createTable tableName="image">
			<column name="id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="imagekey" type="varchar(500)">
				<constraints nullable="false"/>
			</column>
			<column name="applicationid" type="int">
				<constraints nullable="false" references="Application(id)" foreignKeyName="fk_application_id"/>
			</column>
			<column name="width" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="height" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="imagetypeid" type="varchar(10)">
				<constraints nullable="false" references="imagetype(id)" foreignKeyName="fk_imagetype_id"/>
			</column>
			<column name="filepath" type="varchar(500)">
				<constraints nullable="false"/>
			</column>
			<column name="filesize" type="bigint">
				<constraints nullable="false"/>
			</column>
			<column name="created" type="datetime" defaultValueComputed="${now}">
				<constraints nullable="false"/>
			</column>
			<column name="updated" type="datetime"/>
		</createTable>
		<createIndex
				indexName="ix_image_imagekey_applicationid"
				tableName="image"
				unique="true">
			<column name="applicationid" type="int"/>
			<column name="imagekey" type="varchar(500)"/>
		</createIndex>
	</changeSet>

	<changeSet id="201307071316" author="arne">
		<comment>Insert default image types</comment>
		<insert tableName="imagetype">
			<column name="id">jpeg</column>
			<column name="contenttype">image/jpeg</column>
		</insert>
		<insert tableName="imagetype">
			<column name="id">png</column>
			<column name="contenttype">image/png</column>
		</insert>
		<insert tableName="imagetype">
			<column name="id">gif</column>
			<column name="contenttype">image/gif</column>
		</insert>
	</changeSet>

	<changeSet id="201307261349" author="arne">
		<comment>Insert svg/eps/pdf image types</comment>
		<insert tableName="imagetype">
			<column name="id">svg</column>
			<column name="contenttype">image/svg+xml</column>
		</insert>
		<insert tableName="imagetype">
			<column name="id">eps</column>
			<column name="contenttype">image/eps</column>
		</insert>
		<insert tableName="imagetype">
			<column name="id">pdf</column>
			<column name="contenttype">application/pdf</column>
		</insert>
	</changeSet>

	<changeSet id="201307271308" author="arne">
		<comment>Insert tiff image type</comment>
		<insert tableName="imagetype">
			<column name="id">tif</column>
			<column name="contenttype">image/tiff</column>
		</insert>
	</changeSet>
</databaseChangeLog>