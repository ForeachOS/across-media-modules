<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.foreach.imageserver.dao.GroupDao">

	<sql id="groupColumns">
        G.id as group_id,
        G.name as group_name,
        G.applicationid as group_applicationid
    </sql>

	<resultMap id="groupMap" type="Group">
		<id property="id" column="group_id"/>
		<result property="name" column="group_name"/>
		<result property="applicationId" column="group_applicationid"/>
		<collection property="formats" column="group_id" javaType="ArrayList" ofType="Format" resultMap="com.foreach.imageserver.dao.FormatDao.formatMap"/>
	</resultMap>

	<select id="getGroupById" parameterType="int" resultMap="groupMap">
		SELECT
		<include refid="groupColumns"/>,
        <include refid="com.foreach.imageserver.dao.FormatDao.formatColumns"/>

		FROM ImageGroup G LEFT JOIN Format F ON F.groupid = G.id
		WHERE G.id = #{value}
	</select>

	<select id="allGroupsByApplicationId" parameterType="int" resultMap="groupMap">
		SELECT
		<include refid="groupColumns"/>,
        <include refid="com.foreach.imageserver.dao.FormatDao.formatColumns"/>
		FROM ImageGroup G LEFT JOIN Format F ON F.groupid = G.id
		WHERE G.applicationid = #{value}
	</select>

    <insert id="insertGroup" parameterType="Group" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO ImageGroup (
            name,
            applicationid
        ) VALUES (
            #{name},
            #{applicationId}
        )
    </insert>

    <update id="updateGroup" parameterType="Group">
        UPDATE ImageGroup
        SET
            name = #{name}
        WHERE id = #{id}
    </update>

    <delete id="deleteGroup" parameterType="int">
        DELETE
        FROM ImageGroup
        WHERE id = #{value}
    </delete>

</mapper>