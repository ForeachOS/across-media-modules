<!doctype html>
<html lang="en" ng-app="viewImageApp">
<head>
    <title>My HTML File</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.8/angular.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.8/angular-route.js"></script>
</head>
<body ng-controller="ViewImageController">

<div>
    <input type="text" ng-model="imageServerKey" ng-enter="loadImage()"/>
    <a href="#{{imageServerKey}}" ng-click="loadImage()">load</a>
</div>

<div ng-if="image">
    <div style="float: left;display: block">
        <div>
            <strong>external id:</strong> {{image.externalId}}<br/>
            <strong>width:</strong> {{image.dimensionsDto.width}}<br/>
            <strong>height:</strong> {{image.dimensionsDto.height}}<br/>
            <strong>type:</strong> {{image.imageType}}
        </div>

        <select ng-model="context" ng-change="selectContext(context)">
            <option value="ONLINE">online</option>
            <option value="DIGITAL">digital</option>
        </select>

        <select ng-model="imageType" ng-change="selectImageType(imageType)">
            <option value="JPEG">jpeg</option>
            <option value="PNG">png</option>
        </select>

        <ul>
            <li ng-repeat="resolution in resolutions | orderBy:['width','height']">
                <a href="#" ng-click="renderPreview(resolution.width, resolution.height)">{{resolution.width}}x{{resolution.height}}</a>
            </li>
        </ul>
    </div>

    <div style="float: left; margin-left: 30px;">
        <img style="border: solid 1px black; background-color: gainsboro;" src="/view?iid={{image.externalId}}&amp;imageType={{imageType}}&amp;width={{resolution.width}}&amp;height={{resolution.height}}&amp;context={{context}}" />
    </div>
</div>

<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/
    var app = angular.module('viewImageApp', []);

    app.directive('ngEnter', function () {
        return function (scope, element, attrs) {
            element.bind("keydown keypress", function (event) {
                if (event.which === 13) {
                    scope.$apply(function () {
                        scope.$eval(attrs.ngEnter, {'event': event});
                    });

                    event.preventDefault();
                }
            });
        };
    });

    app.controller('ViewImageController', function ($scope, $http) {
        $scope.context = 'ONLINE';
        $scope.resolution = {'width':0,'height':0};
        $scope.image = null;
        $scope.previewUrl = '';
        $scope.imageType = 'JPEG';

        $scope.loadImage = function () {
            $http.get('/imageInfo?token=azerty&iid=' + $scope.imageServerKey).success(function (data) {
                if (data.result.existing) {
                    $scope.image = data.result;
                }
                else {
                    $scope.image = null;
                }
            });
        };

        $scope.selectImageType = function(imageType) {
          $scope.imageType = imageType;
        };

        $scope.selectContext = function ($ctx) {
            $scope.context = $ctx;
            $http.get('/modification/listResolutions?token=azerty&context=' + $ctx).success(function (data) {
                $scope.resolutions = data.result;
            });
        };

        $scope.renderPreview = function( width, height ){
            $scope.resolution = {'width':width,'height':height};
            //$scope.previewUrl = '/view?iid=' + $scope.image.externalId +'&imageType=' + $scope.imageType + '&context=' + $scope.context + '&width=' + width + '&height=' + height;
        };

        $scope.selectContext();


    });
    /*]]>*/
</script>
</body>
</html>