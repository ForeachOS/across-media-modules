<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <property name="now" value="GETDATE()" dbms="mssql"/>
    <property name="now" value="NOW" dbms="hsqldb"/>

    <changeSet id="201403091254" author="ovh">
        <createTable tableName="APPLICATION">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="active" type="boolean" defaultValueBoolean="false"/>
            <column name="code" type="varchar(36)">
                <constraints nullable="false"/>
            </column>
            <column name="created" type="datetime" defaultValueComputed="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="updated" type="datetime"/>
        </createTable>
    </changeSet>

    <changeSet id="201403091310" author="ovh">
        <createTable tableName="IMAGE">
            <column name="imageId" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="applicationId" type="int">
                <constraints nullable="false" references="Application(id)" foreignKeyName="fk_image_application_id"/>
            </column>
            <column name="created" type="datetime" defaultValueComputed="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="repositoryCode" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="originalImageId" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="IMAGE"
                       columnNames="applicationId,imageId"
                       constraintName="pk_image"/>
    </changeSet>

    <changeSet id="201403091327" author="ovh">
        <createTable tableName="IMAGE_RESOLUTION">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="width" type="int">
                <constraints nullable="true"/>
            </column>
            <column name="height" type="int">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <createTable tableName="APPLICATION_IMAGE_RESOLUTIONS">
            <column name="applicationId" type="int">
                <constraints nullable="false" references="APPLICATION(id)"
                             foreignKeyName="fk_application_resolution_1"/>
            </column>
            <column name="imageResolutionId" type="int">
                <constraints nullable="false" references="IMAGE_RESOLUTION(id)"
                             foreignKeyName="fk_application_resolution_2"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="201403091352" author="ovh">
        <createTable tableName="IMAGE_MODIFICATION">
            <column name="imageId" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="resolutionId" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="densityWidth" type="int" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="densityHeight" type="int" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="stretch" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="keepAspect" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="cropX" type="int" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="cropY" type="int" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="cropWidth" type="int" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="cropHeight" type="int" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="cropSourceWidth" type="int" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="cropSourceHeight" type="int" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="IMAGE_MODIFICATION"
                       columnNames="imageId,resolutionId"
                       constraintName="pk_image_modification"/>
    </changeSet>
</databaseChangeLog>
